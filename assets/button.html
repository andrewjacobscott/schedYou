<!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <link rel="stylesheet" type="text/css" href="../css/styles.css">
      <script src="../js/index.js" type="text/javascript"></script>
      <script src="../js/button.js" type="text/javascript"></script>
      <link href="https://bootswatch.com/4/journal/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
      <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

      <title>SchedYou</title>
    </head>

    <body>





      <div class="container" id="box">
        <form id="form-start">
          <div class="form-group">
            <label for="name">Event title (Required)</label>
            <input type="text" class="form-control" id="name" placeholder="Event Title">
          </div>
          <div class="form-group">
            <label for="desc">Event Description</label>
            <textarea class="form-control" id="desc" placeholder="Event Description" rows="5" cols="50"></textarea>
          </div>
          <div class="form-group">
            <label for="eventStart">Event Start Time</label>
            <input id="start" type="time" value= "08:00">
          </div>
          <div class="form-group">
            <label for="eventStartDate">Start Date</label>
            <input id="startDate" type="date">
          </div>
          <div class="form-group">
            <label for="eventEnd">Event End Time</label>
            <input id="end" type="time" value="09:00">
          </div>
          <div class="form-group">
            <label for="eventEndDate">End Date</label>
            <input id="endDate" type="date">
          </div>

          <small id="message" class="form-text text-muted"></small>

          <button type="submit" class="btn btn-info" id= "send" onclick="addOrEditHandler()">Submit</button>
          <button class="btn btn-secondary" onclick="decideClose()">Cancel</button>
          <button id="removeButton" class="btn btn-info" onclick="remove()" style="visibility:hidden" disabled=true>Remove</button>
        </form>
      </div>
    </body>

    <script>
      var eventIDNo; // = getEventID()
      var editing =false;
      var eventList;
    </script>


    <script>
      var getHours = require('date-fns/get_hours');
      var getMinutes = require('date-fns/get_minutes');
      var format = require('date-fns/format');

      function addOrEditHandler() {
          if (editing) {
            deleteEvent(eventIDNo);
          }
          calcFreeSpace();
      }
      function remove() {
        deleteEvent(eventIDNo);
        //eventList = JSON.parse(localStorage.getItem("eventsArr"));
        //console.dir(eventList);
        
        window.close();
      }
      function decideClose() {
        /*
        if (editing) {
          calcFreeSpace();
        }
        */
        window.close();
      }
    function fillValues(eventObj) {
      var form = document.getElementById("form-start");
      console.dir(form);
      var i;
      for (i = 0; i < form.children.length ; i++) {
        if (i == 0) {
          form.children[i].children[1].value = eventObj.eName;
        }
        else if(i == 1) {
          form.children[i].children[1].value = eventObj.eDesc;
        }
        else if(i == 2) {
         // form.children[i].children[1].value = getHours(eventObj.eStartDate) + ":" + startMins;
          form.children[i].children[1].value = format(eventObj.eStartDate, 'HH:mm');
        }
        else if(i == 3) {
          form.children[i].children[1].value = format(eventObj.eStartDate,'YYYY-MM-DD');
        }
        else if(i == 4) {
          form.children[i].children[1].value = format(eventObj.eEndDate, 'HH:mm');
        }
        else if(i == 5) {
          form.children[i].children[1].value = format(eventObj.eEndDate,'YYYY-MM-DD');
        }
        
      }
    }
    var obj = JSON.parse(localStorage.getItem("eventObj"));
    console.dir(obj);
    if (obj != null) {
      editing = true;
      fillValues(obj);
      localStorage.setItem("eventObj", "");
      var b =document.getElementById("removeButton");
      b.style.visibility = "visible"
      b.disabled = false;
      eventIDNo=obj.eID;
      //console.log("READ ID: " + eventIDNo);

    }
    else {
      editing = false;
    }


      /*
      $(".send").click(function(event) {
        btnMostrarSeccion($(this));
        event.preventDefault();
      })
      */

      /*
      window.addEventListener("keyup", function(event){
        if(event.keyCode == 13){
          document.getElementById("send").click();
          return;
        }
        if(event.keyCode == 27){
          getCurrentWindow().close();

        }
      });
      */

      function calcFreeSpace() {
          const {getCurrentWindow} = require('electron').remote;
          var eName = document.getElementById("name").value;
          var eDesc = document.getElementById("desc").value;
          var start = document.getElementById("start").value;
          var startDate = document.getElementById("startDate").value;
          var end = document.getElementById("end").value;
          var endDate = document.getElementById("endDate").value;

          if(eName === "" || start === "" || startDate === "" || end === "" ){
            document.getElementById("message").innerHTML = "Missing event name or length\nclick cancel to exit";
            return;
          }
          //eventIDNo = getEventID();

          localStorage.setItem("name",eName);
          localStorage.setItem("desc", eDesc);
          localStorage.setItem("start", start);
          localStorage.setItem("startDate", startDate);
          localStorage.setItem("end", end);
          localStorage.setItem("endDate",endDate);
          //localStorage.setItem("eventID",eventIDNo);

          getCurrentWindow().hide();
      }      
    </script>
  </html>
